{template 'header','mobile'}
{template 'phblishform','mobile/share'}
<section class="publishform publishformfdfd">
    <article>
        <form id="publishform" method="post" action="/mobile/share/publish.php?isajax=1">
            <p class="clearfix" style="margin-bottom:0px;border:0px;">
                <span class="publishleft publishnew" style="width:80px;"><i class="red">*</i>名称</span>
                <span class="publishright publishrightnew" style="padding-left:80px;">
                    <input type="text" name="title" value="<?php echo isset($info['title'])?$info['title']:''; ?>" maxlength="50" datatype="*2-50" class="input-text" />
                    <br />
                    <span class="Validform_checktip"></span>
                </span>
            </p>
            {template  'publishimg','mobile/share'}
            <p class="clearfix" style="padding-top:5px;border-top:0px;padding-bottom:10px;">
                <span class="publishleft"><i class="red"></i>描述</span>
                <span class="publishright">
                    <textarea name="content" id="content" class="input-text"><?php echo isset($info['content'])?$info['content']:'' ?></textarea>
                    <?php echo deditor(2, 'content','', '100%', 160); ?>

                </span>
            </p>
            {template  'publishcat','mobile/share'}
            <p class="clearfix" style="margin-bottom:0px;">
                <span class="publishleft publishnew" style="width:140px;"><img src="{DT_SKIN}image/mobile/publish2.png" /><i class="red">&nbsp;</i>技术合作费</span>
                <span class="publishright publishrightnew" style="padding-left:140px;">
                    <input type="text" name="coofee" value="<?php echo isset($info['coofee'])?$info['coofee']:0; ?>" maxlength="50" datatype="empty|money" class="input-text smallinput" />
                    <span style="font-size:0.8em;">元</span>
                    <br />
                    <span class="Validform_checktip"></span>
                </span>
            </p>
            <div class="btn-box clear">
                <input  type="hidden" name="submit" value="1"/>
                <input  type="hidden" name="itemid" value="<?php echo $itemid ?>"/>
                <input  type="hidden" name="beforeurl" value="<?php echo $forward; ?>"/>
                <input type="hidden" name="moduleidtype" value="4" />
                <input type="hidden" value="{if isset($code)}{$code}{/if}"  name="code"  />
                <input class="quepublish" type="submit" value="确定发布"/>
            </div>
        </form>
    </article>
</section>
<script src="{DT_SKIN}js/jquery-1.9.1.min.js"></script>
<script src="{DT_SKIN}js/Validform_v5.3.2_min.js"></script>
<script>
    $("#publishform").Validform({
        tiptype: 3,
        postonce:true,
        ajaxPost:true,
        datatype:{
            "mobile":function(gets,obj,curform,regxp){
                if(!is_mobile(gets) && !is_phone(gets)) return '输入错误';
                return true;
            },
            'money':function(gets,obj,curform,regxp){
                if(!is_price(gets)) return false;
                return true;
            },
            'empty':function(gets,obj,curform,regxp){
                if(gets.length==0) return true;
                return false;
            }
        },
        beforeCheck:function(curform){
            var isnotselect = true;
            var dn = 0;
            $("#publishform select").each(function(){
                var selvel = $(this).val();
                if($(this).attr("isarea")==1 && selvel!=0){
                    dn = dn+1;
                }
                if(selvel==0 && !($(this).attr("isarea")==1 && dn>=2)){
                    isnotselect = false;
                    $(this).parent().parent().find('.Validform_checktip').removeClass('Validform_right').addClass('Validform_wrong').html('请选择');
                    $(this).focus();
                    return false;
                }
            })
            if(!isnotselect) return false;
            return true;
        },
        beforeSubmit:function(curform){
            var oEditor = FCKeditorAPI.GetInstance('content');
            $("#content").html(oEditor.GetHTML());
            getToken();
            return true;
        },
        callback:function(data){
            layer.open({
                content: data.info,
                title:'提示'
            });
            if(data.status=='y'){
                window.setTimeout("locationhref('"+data.url+"')",1000);
            }
        }
    })
    $(document).on("change","select",function(){
        $(this).parent().parent().find('.Validform_checktip').removeClass('Validform_wrong').html('');
    })
    function locationhref(url){
        if(url!='aa'){
            location.href = url;
        }else{
            location.reload();
        }
    }
</script>
{template 'footer','mobile'}