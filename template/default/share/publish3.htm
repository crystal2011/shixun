{template  'header'}
<link rel="stylesheet" href="{DT_SKIN}css/publish.css"/>
<script type="text/javascript" src="<?php echo DT_STATIC;?>lang/<?php echo DT_LANG;?>/lang.js"></script>
<script type="text/javascript" src="<?php echo DT_STATIC;?>file/script/config.js"></script>
<script type="text/javascript" src="<?php echo DT_STATIC;?>file/script/common.js"></script>
<script type="text/javascript" src="<?php echo DT_STATIC;?>file/script/admin.js"></script>
<section class="home">
    <header class="sites">
        <a href="/">首页</a>&nbsp;&gt;&nbsp;<a href="/share/publish.php">信息发布</a>
    </header>
</section>
<section class="home clearfix border-box">
    <header class="publish-head">信息发布</header>
    <article class="publish-box">
        <form id="publishform" method="post" action="/share/publish.php?isajax=1">
            <h3>基本选项</h3>
            <p class="check-item  clearfix">
                <span class="publish-title fl"><em>*</em><label>发布类目：</label></span>
                <span class="fl publish-boxa">
                    <a href="/share/publish.php?moduleidtype=0">餐饮供应</a>
                    <a href="/share/publish.php?moduleidtype=1">商家优惠</a>
                    <a href="/share/publish.php?moduleidtype=2">招聘信息</a>
                    <a class="cur-btn" href="/share/publish.php?moduleidtype=3">店铺转让</a>
                    <a href="/share/publish.php?moduleidtype=4">菜系</a>
                    <a href="/share/publish.php?moduleidtype=5">分享</a>
                    <a href="/share/publish.php?moduleidtype=6">文章</a>
                </span>
            </p>
            {if empty($itemid)}
            <p class="clearfix">
                <span class="publish-title fl">
                    <em>*</em><label>内容审核号：</label>
                </span>
                <span class="fl">
                    <input type="text" class="text-input" errormsg="请输入正确优惠码" ajaxurl="/ajax.php?action=ajax&at=horncode&type=3" name="code" datatype="n6-6" /><span class="Validform_checktip" style="display:inline-block"></span>
                </span>
            </p>
            {/if}
            <p class="clearfix">
                <span class="publish-title fl">
                    <em>*</em><label>名称：</label>
                </span>
                <span class="fl">
                    <input class="text-input" type="text" name="title" value="<?php echo isset($info['title'])?$info['title']:''; ?>" maxlength="50" datatype="*2-50" placeholder="名称"/><span class="Validform_checktip" style="display:inline-block"></span>
                </span>
            </p>
            <p class="clearfix">
                <span class="publish-title fl"><em>*</em><label>分类选择：</label></span>
                <span class="fl">{ajax_category_select('catid', '选择分类', isset($info['catid'])?$info['catid']:0, 13)}<span class="Validform_checktip" style="display:inline-block"></span></span>
            </p>

            <p class="clearfix">
                <span class="publish-title fl">
                    <em>*</em><label>上传图片：</label>
                </span>
                <span class="fl">
                    <input name="thumb" id="thumb" type="text" datatype="url" value="<?php echo isset($info['thumb'])?$info['thumb']:'' ?>" nullmsg="请上传图片" errormsg="格式有误" class="text-input"/>&nbsp;&nbsp;<span onclick="Dthumb(2,'','', Dd('thumb').value,true,'','',500);" class="jt">[上传]</span>
                    <span class="Validform_checktip" style="display:inline-block"></span>
                </span>
            </p>
            <p class="clearfix">
                <span class="publish-title fl">
                    <label>价格：</label>
                </span>
                <span class="fl">
                    <input  class="text-input" name="price" value="<?php echo isset($info['price'])?$info['price']:''; ?>" datatype="empty|money" type="text"  placeholder="100.00"/>
                    <span class="Validform_checktip" style="display:inline-block"></span>
                </span>
                    </p>
                    <p class="clearfix">
                <span class="publish-title fl">
                    <label>餐位：</label>
                </span>
                <span class="fl">
                    <input  class="text-input" name="seat" value="<?php echo isset($info['seat'])?$info['seat']:''; ?>" datatype="empty|n1-4" type="text"  placeholder="100"/>
                    <span class="Validform_checktip" style="display:inline-block"></span>
                </span>
                    </p>
                    <p class="clearfix">
                <span class="publish-title fl">
                    <label>平方：</label>
                </span>
                <span class="fl">
                    <input  class="text-input" name="acreage" value="<?php echo isset($info['acreage'])?$info['acreage']:''; ?>" datatype="empty|n1-4" type="text"  placeholder="100"/>
                    <span class="Validform_checktip" style="display:inline-block"></span>
                </span>
            </p>
            <div id="shownow"></div>
            <h3 class="phonehtml">联系方式</h3>
            <p class="clearfix mobilehtml">
                <span class="publish-title fl">
                    <label>电话：</label>
                </span>
                <span class="fl">
                    <input class="text-input" type="text" name="mobile" value="<?php echo isset($info['phone'])?$info['phone']:(isset($info['telephone'])?$info['telephone']:'') ?>" maxlength="15"  placeholder="134****3456/020-0000111"/>
                    <span class="Validform_checktip" style="display:inline-block"></span>
                </span>
            </p>
            <p class="clearfix areahtml">
                <span class="publish-title fl">
                     <em>*</em><label>地址：</label>
                </span>
                <span class="fl">
                    {ajax_area_select('areaid', '请选择', isset($info['areaid'])?$info['areaid']:0,'isarea="1"')}
                    <input datatype="*3-50" maxlength="50" value="<?php echo isset($info['address'])?$info['address']:'' ?>" class="text-input" name="address" type="text" placeholder="详细地址"/>
                    <span class="Validform_checktip" style="display:inline-block"></span>
                </span>
            </p>
            <h3>详细内容</h3>
            <textarea name="content" id="content" class="dsn"><?php echo isset($info['content'])?$info['content']:'' ?></textarea>
            <?php echo deditor(2, 'content','', '100%', 350); ?>

            <div class="btn-box">
                <input  type="hidden" name="submit" value="1"/>
                <input  type="hidden" name="itemid" value="<?php echo $itemid ?>"/>
                <input  type="hidden" name="beforeurl" value="<?php echo $forward; ?>"/>
                <input type="hidden" name="moduleidtype" value="3" />
                <input style="background:#ea5550;" type="submit" value="提交"/>
            </div>
        </form>

    </article>
</section>
<script src="{DT_SKIN}js/Validform_v5.3.2_min.js"></script>
<link rel="styleSheet" href="{DT_SKIN}js/layer/skin/layer.css">
<script src="{DT_SKIN}js/layer/layer.js"></script>
<script>
    $("#publishform").Validform({
        tiptype: 3,
        postonce:true,
        ajaxPost:true,
        datatype:{
            "mobile":function(gets,obj,curform,regxp){
                if(!is_mobile(gets) && !is_phone(gets)) return '输入错误';
                return true;
            },
            'money':function(gets,obj,curform,regxp){
                if(!is_price(gets)) return false;
                return true;
            },
            'empty':function(gets,obj,curform,regxp){
                if(gets.length==0) return true;
                return false;
            }
        },
        beforeCheck:function(curform){
            var isnotselect = true;
            var dn = 0;
            $("#publishform select").each(function(){
                var selvel = $(this).val();
                if($(this).attr("isarea")==1 && selvel!=0){
                    dn = dn+1;
                }

                if(selvel==0 && !($(this).attr("isarea")==1 && dn>=2)){
                    isnotselect = false;
                    $(this).parent().parent().find('.Validform_checktip').removeClass('Validform_right').addClass('Validform_wrong').html('请选择');
                    $(this).focus();
                    return false;
                }
            })
            if(!isnotselect) return false;
            return true;
        },
        beforeSubmit:function(curform){
            var oEditor = FCKeditorAPI.GetInstance('content');
            $("#content").html(oEditor.GetHTML());
            getToken();
            return true;
        },
        callback:function(data){
            layer.msg(data.info);
            if(data.status=='y'){
                window.setTimeout("locationhref('"+data.url+"')",1000);
            }
        }
    })

    $(document).on("change","select",function(){
        $(this).parent().parent().find('.Validform_checktip').removeClass('Validform_wrong').html('');
    })

    function locationhref(url){
        if(url!='aa'){
            location.href = url;
        }else{
            location.reload();
        }
    }

</script>
{template  'footer'}
